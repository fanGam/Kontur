# Проект-решение для анализа результатов тестирования
## Описание
Поставленна задача написать программу, которая собирает и анализирует результаты тестирования и определяет, 
сколько каждый пользователь набрал баллов, при этом учитывает, что есть разные группы вопросов.

## Содержание
1. [Требования](#Требования)
2. [Настройка](#Настройка)
3. [Структура](#Структура)
4. [Использование](#Использование)

## Требования
Проект рассчитан на работу:
- Python 3.8+
- pip
- pandas, sqlalchemy
- Microsoft SQL Server 22

## Настройка
Для первичной настройки можно изменить файл [конфигурации](config.txt). Где написана входная строка в формате: 
>mssql+pyodbc://*"Пользователь:Пароль"*@"Адрес сервера (ip или имя)"/master?driver=ODBC+Driver+17+for+SQL+Server
>test"Базовое название создаваемой базы"

Также есть возможность автоматически заполнить файл при создании базы.

## Структура
Код поделён на 4 смысловые части:
- [Создание базы](#Создание-базы)
- [Ввод данных](#Ввод-данных)
- [Сбор данных для общего анализа](#Сбор-данных-для-общего-анализа)
- [Анализ данных и подготовка к выгрузке](#Анализ-данных-и-подготовка-к-выгрузке)

### Создание базы
Процедура create_db() отвечает за создание базы данных в SQL Server.
В начале проверяется наличие файла конфигурации если его нет, будет предложена настройка.
Вы сможете сами внести необходимые данные для подключения.
В случае, если данные пресутствуют, то будет проверка на существование базы.
В случае, если вы хотите перезаписать, то база данных будет удалена и поставленна снова.
В конечном итоге, вам будет предложенно заполнить файл config.txt автоматически.
Создаваемая база имеет вид
'''
CREATE TABLE test (
    user_id INT, - id_пользователя - используется id пользователя на площадке, для дальнейгего поиска информации о пользователе
    question_id SMALLINT, - номер вопроса
    answer SMALLINT, - номер ответа (при необходимости можно изменить на VARCHAR())
    answer_group SMALLINT, - номер группы вопросов по счёту
    answer_time DATETIME NOT NULL, - дата и время сдачи вопроса
    PRIMARY KEY (user_id, question_id)
);
'''


### Ввод данных
Процедура make_answer(user_id, question_id, answer, answer_group) принимает на вход:
- user_id
- question_id
- answer
- answer_group
После чего выполняет INSERT запрос в таблицу, для создания записи сдачи вопроса
Рекомендуется использовать пользователя с user_id = 1 для дальнейшей проверки ответов

### Сбор данных для общего анализа
Процедура stats выводит информацию о пользователях, сдавших тест в формате pandad DataFrame.
Её легко можно переделать в функцию и вытягивать DataFrame для дальнейшего анализа.
стоит учесть, что проверка правильных ответов происходит путём сравнения с эталоном у user_id = 1.
Чтобы это изменить нужно изменить значения в следующей строке
> correct_ans = df[df["user_id"] == 1].set_index("question_id")["answer"]

### Анализ данных и подготовка к выгрузке
Более глубокий анализ, который помимо проверки правильных ответов, также выводит информацию о том, как сдали пользователи каждую группу вопросов.
Для этого используется кооэффициент 0.75 от эталона, его всегда можно заменить, исправив эту часть кода:
'''
min_scores = (
    correct_counts[correct_counts["user_id"] == 1].
    set_index("answer_group")["correct_by_group"].
    mul(0.75). # отвечает за множитель 
    rename("min_scores").
    reset_index()
)
'''

Снова не стоит забывать об эталонном решении:
> correct_ans = df[df["user_id"] == 1].set_index("question_id")["answer"]